<!DOCTYPE html>  
<html lang="zh-cmn-Hans">  
 <head>
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">  
    <title>百度地图导航</title>  
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=Bu2R9CL2HuX46udqG2Q2S9AIhdedkuh8"></script>    
    <style type="text/css">  
        body, html,#allmap {width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";}  
    </style>   
 
</head>  
  
<body>    
   <div id="allmap"></div>  
</body>    
</html>    
<script type="text/javascript">


    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]); return null;
    }

    var destinationLat = GetQueryString("latitude");
    var destinationLng = GetQueryString("longitude");


    var map = new BMap.Map("allmap");      
  
    var geolocation = new BMap.Geolocation();  
    geolocation.getCurrentPosition(function(r){  
        if(this.getStatus() == BMAP_STATUS_SUCCESS){  
           
            //map.panTo(r.point);//地图中心点移到当前位置  
            var latCurrent = r.point.lat;  
            var lngCurrent = r.point.lng;  
            //alert('我的位置：'+ latCurrent + ',' + lngCurrent);  

            location.href = "http://api.map.baidu.com/direction?origin=" + latCurrent + "," + lngCurrent + "&destination=" + destinationLat + "," + destinationLng + "&mode=driving&region=常熟&output=html";  
  
        }  
        else {  
            alert('failed'+this.getStatus());  
        }          
    },{enableHighAccuracy: true})  
   var point=new BMap.Point(destinationLng,destinationLat);
            var mk = new BMap.Marker(point);  
             map.addOverlay(mk);  
  
    
  
  
</script> 